<?php

namespace NO\GestionnaireBundle\Repository;

use Doctrine\ORM\Tools\Pagination\Paginator;
/**
 * TacheRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class TacheRepository extends \Doctrine\ORM\EntityRepository
{
	public function afficheTachesMeres()
	{
		return $this
			->createQueryBuilder('t')
			->where('t.tacheMeres is null');
	}

	public function afficheTachesEnfant()
	{
		return $this
			->createQueryBuilder('te')
			->where('te.tacheMeres is not null');
	}

	public function sommeRaf($idProjet)
	{
		$somme = $this->createQueryBuilder('ta')
								->select('sum(ta.raf) as sommeRaf')
								->addSelect('sum(ta.joursRealises) as sommeJoursRealises')
								->where('ta.projet = :idProjet')
								->setParameter('idProjet', $idProjet)
								->getQuery();
		return $somme->getResult();
	}

	public function afficheTout($idProjet)
	{
		$affiche = $this->createQueryBuilder('ta')
						->select('ta')
						->leftJoin('ta.joursVendus', 'jv')
						->addSelect('jv')
						->where('ta.projet = :idProjet')
						->andWhere('ta.tacheMeres is not null')
						->orderBy('jv.tache')
						->addOrderBy('jv.profil')
						->setParameter('idProjet', $idProjet)
						->getQuery();
		return $affiche->getResult();
	}
}
